
### 计算机网络体系结构

![](https://resource.lzyan.fun/PigGo/20220227144357.png)

> 图源来自 《 计算机网络（第7版）谢希仁 》

**OSI 七层模型** 是国际标准化组织提出的一个网络分层模型。

**TCP/IP 四层模型** 是目前被广泛采用的一种模型，可以将 **TCP / IP 模型** 看作是 `OSI` 七层模型的精简版本。

`OSI` 的七层体系结构概念清楚，理论也很完整，但是它比较复杂而且不实用，而且有些功能在多个层中重复出现。但是为更好地了解计算机网络，了解 `OSI` 七层模型还是非常必要。

`OSI` 七层模型总结图（更通俗易懂）：

![](https://resource.lzyan.fun/PigGo/osi-model-detail.1e3522a7.png)

### TCP/IP 四层模型

TCP/IP 四层模型 是目前被广泛采用的一种模型,我们可以将 TCP / IP 模型看作是 OSI 七层模型的精简版本，由以下 4 层组成：

1. 应用层
2. 传输层
3. 网络层
4. 网络接口层

不同的解读：

- [TCP/IP 网络模型有哪几层？](https://xiaolincoding.com/network/1_base/tcp_ip_model.html#%E5%BA%94%E7%94%A8%E5%B1%82)

- [一文读懂两台计算机之间是如何通信的](https://veal98.gitee.io/cs-wiki/#/20-%E5%A4%A7%E5%8E%82%E9%9D%A2%E8%AF%95%E7%81%AB%E7%AE%AD%E8%AE%A1%E5%88%92-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1-%E4%B8%80%E6%96%87%E8%AF%BB%E6%87%82%E4%B8%A4%E5%8F%B0%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B9%8B%E9%97%B4%E6%98%AF%E5%A6%82%E4%BD%95%E9%80%9A%E4%BF%A1%E7%9A%84?id=%f0%9f%92%bb-%e4%b8%80%e6%96%87%e8%af%bb%e6%87%82%e4%b8%a4%e5%8f%b0%e8%ae%a1%e7%ae%97%e6%9c%ba%e4%b9%8b%e9%97%b4%e6%98%af%e5%a6%82%e4%bd%95%e9%80%9a%e4%bf%a1%e7%9a%84)

- [TCP/IP 四层模型](https://javaguide.cn/cs-basics/network/osi&tcp-ip-model.html#tcp-ip-%E5%9B%9B%E5%B1%82%E6%A8%A1%E5%9E%8B)

### HTTP 协议

#### 1. HTTP协议1.0\1.1\2.0

**HTTP1.0：**服务器处理完成后立即断开TCP连接（**无连接**），服务器不跟踪每个客户端也不记录过去的请求（**无状态**）

​**HTTP1.1：**KeepAlived**长连接**避免了连接建立和释放的开销；通过Content-Length来判断当前请求数据是否已经全部接受（**有状态**）

​**HTTP2.0：**引入二进制数据帧和流的概念，其中帧对数据进行顺序标识；因为有了序列，服务器可以**并行**的传输数据。

**HTTP1.0和HTTP1.1的主要区别：**
​		1、缓存处理：1.1添加更多的缓存控制策略（如：Entity tag，If-Match）
​		2、网络连接的优化：1.1支持断点续传
​		3、错误状态码的增多：1.1新增了24个错误状态响应码，丰富的错误码更加明确各个状态
​		4、Host头处理：支持Host头域，不在以IP为请求方标志
​		5、长连接：减少了建立和关闭连接的消耗和延迟。

​**HTTP1.1和HTTP2.0的主要区别：**
​		1、新的传输格式：2.0使用二进制格式，1.0依然使用基于文本格式
​		2、多路复用：连接共享，不同的request可以使用同一个连接传输（最后根据每个request上的id号组合成正常的请求）
​		3、header压缩：由于1.X中header带有大量的信息，并且得重复传输，2.0使用encoder来减少需要传输的hearder大小
​		4、服务端推送：同google的SPDUY（1.0的一种升级）一样

#### 2. HTTP 与 HTTPS 之间的区别

|              HTTP              |                  HTTPS                   |
| :----------------------------: | :--------------------------------------: |
|           默认端口80           |           HTTPS默认使用端口443           |
| 明文传输、数据未加密、安全性差 |       传输过程ssl加密、安全性较好        |
|     响应速度快、消耗资源少     | 响应速度较慢、消耗资源多、需要用到CA证书 |


**HTTPS链接建立的过程：**

​1.首先客户端先给服务器发送一个请求

​2.服务器发送一个SSL证书给客户端，内容包括：证书的发布机构、有效期、所有者、签名以及公钥

​3.客户端对发来的公钥进行真伪校验，校验为真则使用公钥对对称加密算法以及对称密钥进行加密

​4.服务器端使用私钥进行解密并使用对称密钥加密确认信息发送给客户端

​5.随后客户端和服务端就使用对称密钥进行信息传输

​**对称加密算法：**

​双方持有相同的密钥，且加密速度快，典型对称加密算法：DES、AES

​**非对称加密算法：**

​密钥成对出现（私钥、公钥），私钥只有自己知道，不在网络中传输；而公钥可以公开。相比对称加密速度较慢，典型的非对称加密算法有：RSA、DSA

#### 3. Get和Post请求区别 

HTTP请求：

| 方法    | 描述                                                         |
| :------ | ------------------------------------------------------------ |
| GET     | 向特定资源发送请求，查询数据，并返回实体                     |
| POST    | 向指定资源提交数据进行处理请求，可能会导致新的资源建立、已有资源修改 |
| PUT     | 向服务器上传新的内容                                         |
| HEAD    | 类似GET请求，返回的响应中没有具体的内容，用于获取报头        |
| DELETE  | 请求服务器删除指定标识的资源                                 |
| OPTIONS | 可以用来向服务器发送请求来测试服务器的功能性                 |
| TRACE   | 回显服务器收到的请求，用于测试或诊断                         |
| CONNECT | HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器       |

get和Post区别：

|          | GET                                                          | POST                                                       |
| -------- | ------------------------------------------------------------ | ---------------------------------------------------------- |
| 可见性   | 数据在URL中对所有人可见                                      | 数据不会显示在URL中                                        |
| 安全性   | 与post相比，get的安全性较差，因为所发送的数据是URL的一部分 | 安全，因为参数不会被保存在浏览器历史或web服务器日志中 |
| 数据长度 | 受限制，最长2kb                                              | 无限制                                                     |
| 编码类型 | application/x-www-form-urlencoded                            | multipart/form-data                                        |
| 缓存     | 能被缓存                                                     | 不能被缓存                                                 |

#### 4. HTTP常见响应状态码

100：Continue --- 继续。客户端应继续其请求。

200：OK --- 请求成功。一般用于GET与POST请求。

301：Moved Permanently --- 永久重定向。

302：Found --- 暂时重定向。

400：Bad Request --- 客户端请求的语法错误，服务器无法理解。

403：Forbideen --- 服务器理解请求客户端的请求，但是拒绝执行此请求。

404：Not Found --- 服务器无法根据客户端的请求找到资源（网页）。

500：Internal Server Error --- 服务器内部错误，无法完成请求。

502：Bad Gateway --- 作为网关或者代理服务器尝试执行请求时，从远程服务器接收到了无效的响应。

### TCP 三次握手四次挥手

- **三次握手过程：**

​客户端——发送带有SYN标志的数据包——服务端       **一次握手**  Client进入syn_sent状态

​服务端——发送带有SYN/ACK标志的数据包——客户端   **二次握手**  服务端进入syn_rcvd

​客户端——发送带有ACK标志的数据包——服务端       **三次握手**   连接就进入Established状态

- **为什么三次：**

​主要是为了建立可靠的通信信道，保证客户端与服务端同时具备发送、接收数据的能力

- **为什么两次不行？**

​1、防止已失效的请求报文又传送到了服务端，建立了多余的链接，浪费资源

​2、 两次握手只能保证单向连接是畅通的。（为了实现可靠数据传输， TCP 协议的通信双方， 都必须维	护一个序列号， 以标识发送出去的数据包中， 哪些是已经被对方收到的。 三次握手的过程即是通信双方	相互告知序列号起始值， 并确认对方已经收到了序列号起始值的必经步骤；如果只是两次握手， 至多只有连接发起方的起始序列号能被确认， 另一方选择的序列号则得不到确认）

- **四次挥手过程：**

​客户端——发送带有FIN标志的数据包——服务端，关闭与服务端的连接 ，客户端进入FIN-WAIT-1状态

​服务端收到这个 FIN，它发回⼀ 个 ACK，确认序号为收到的序号加1，服务端就进入了CLOSE-WAIT状态

​服务端——发送⼀个FIN数据包——客户端，关闭与客户端的连接，客户端就进入FIN-WAIT-2状态

​客户端收到这个 FIN，发回 ACK 报⽂确认，并将确认序号设置为收到序号加1，TIME-WAIT状态

- **为什么四次：**

​因为需要确保客户端与服务端的数据能够完成传输。

- **CLOSE-WAIT：**

​这种状态的含义其实是表示在等待关闭

- **TIME-WAIT：**

​为了解决网络的丢包和网络不稳定所带来的其他问题，确保连接方能在时间范围内，关闭自己的连接

- **如何查看TIME-WAIT状态的链接数量？**		

​netstat -an |grep TIME_WAIT|wc -l  查看连接数等待time_wait状态连接数

- **为什么会TIME-WAIT过多？解决方法是怎样的？**

​**可能原因：** 高并发短连接的TCP服务器上，当服务器处理完请求后立刻按照主动正常关闭连接

​**解决：**负载均衡服务器；Web服务器首先关闭来自负载均衡服务器的连接

### 浏览器输入 URL 过程

**过程：**DNS解析、TCP连接、发送HTTP请求、服务器处理请求并返回HTTP报文、浏览器渲染、结束

| 过程                                                         | 使用的协议            |
| ------------------------------------------------------------ | --------------------- |
| 1、浏览器查找域名DNS的IP地址DNS查找过程（浏览器缓存、路由器缓存、DNS缓存） | DNS：获取域名对应的ip |
| 2、根据ip建立TCP连接                                         | TCP：与服务器建立连接 |
| 3、浏览器向服务器发送HTTP请求                                | HTTP：发送请求        |
| 4、服务器响应HTTP响应                                        | HTTP                  |
| 5、浏览器进行渲染                                            |                       |

### 细读

- [图解网络](https://xiaolincoding.com/network/) —— 小林coding「图解网络」，涉及比较广泛并且比较通俗易懂，非常适合有一点网络基础，但是又不怎么扎实，或者知识点串不起来的同学。

- [计算机网络那些事](https://veal98.gitee.io/cs-wiki/#/README?id=%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%bd%91%e7%bb%9c) —— 结合上面的一起吸收，效果还是挺好的。