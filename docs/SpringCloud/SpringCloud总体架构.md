## 认识微服务

微服务（Microservices）是一种软件架构风格。随着互联网行业的发展，对服务的要求也越来越高，服务架构也从单体架构逐渐演变为现在流行的微服务架构。

- 单体架构

将业务的所有功能集中在一个项目中开发，打成一个包部署。

优点：架构简单，部署成本低

缺点：耦合度高（维护困难、升级困难）

![](https://resource.lzyan.fun/PigGo/image-20210713202807818.png)

- 分布式架构

根据业务功能对系统做拆分，每个业务功能模块作为独立项目开发，称为一个服务。

优点：降低服务耦合，有利于服务升级和拓展，提升系统并发量

缺点：服务调用关系错综复杂

![](https://resource.lzyan.fun/PigGo/image-20210713203124797.png)

分布式架构虽然降低了服务耦合，但是服务拆分时有很多问题需要思考：

1. 服务拆分的粒度如何界定？
2. 服务之间如何调用？
3. 服务的调用关系如何管理？

于是就需要制定一套标准来为之约束分布式架构。于是微服务架构就诞生了，它是一种经过良好架构设计的**分布式架构方案**，为分布式架构制定了一个标准，进一步降低服务之间的耦合度，提供服务的独立性和灵活性。做到高内聚，低耦合。

但方案该怎么落地？选用什么样的技术栈？全球的互联网公司都在积极尝试自己的微服务落地方案。其中在 Java 领域最引人注目的就是 SpringCloud 提供的方案了。

## 什么是 Spring Cloud

> 官方的介绍：构建分布式系统不需要复杂和容易出错。Spring Cloud 为最常见的分布式系统模式提供了一种简单且易于接受的编程模型，帮助开发人员构建有弹性的、可靠的、协调的应用程序。Spring Cloud 构建于 Spring Boot 之上，使得开发者很容易入手并快速应用于生产中。

`Spring Cloud` 就是微服务系统架构的一站式解决方案，在平时我们构建微服务的过程中需要做如 **服务发现注册** 、**统一配置中心** 、**消息总线** 、**负载均衡** 、**断路器** 、**数据监控** 等操作，而 `Spring Cloud` 为我们提供了一套简易的编程模型，使我们能在 `Spring Boot` 的基础上轻松地实现微服务项目的构建。其中常见的组件包括：

![](https://resource.lzyan.fun/PigGo/image-20210713204155887.png)

以前的服务器就好像，一个会语数外全能的老师，为学生提供服务，这个老师生病了，那全校停课。现在微服务流行后，学校有了数学教研组，语文教研组，外语教研组，每个教研组有一群老师具体负责某科的教学，缺了谁，学校都照样运转。而这个变化中，那些改变历史的程序员就是把一个服务器中的众多服务，或好几台服务器中的众多服务，分类出来，解耦合出来，把他们类似的功能交给同一个集群来做，把互相耦合在一起的功能剥离出来，按业务、按功能来把他们作为一个个微服务放在服务器上，而这个服务器就只提供一个服务，或较少的服务。

让一个超大的服务逻辑，解耦合为一个个小服务，均匀的分布在各自的服务器中。微服务就微在这。每个教研组就是一个微服务集群。他们提供同样的服务，而 **注册中心 Eureka** 就是这个存放这个教研组老师名单的地方，学生们想先访问这个注册中心获取教师名单，然后根据相应的负载方法去访问各自老师。不至于让集群中某一老师累死也不至于让某一老师闲死。

而 **Zuul 网关** 呢，就是学校的门卫，某些学生来学校找谁，它负责指引（路由），并且通过一些非常简单的配置，达到阻拦一些人进入（身份验证），或者控制想学数学的人只能去数学教研组，不能去核能教研组学怎么造原子弹（权限验证）。

那 **Hystrix 熔断器** 呢，可以把它当成学校的志愿者，当一个教研组集体罢课后，学生找不到老师了，这些志愿者及时的告诉来访问的学生，相应的结果，异常信息等，免得大量的学生在学校等待，这些志愿者赶快把这些等待的学生梳理出去，学生一直在学校等待，那其他需要学生的学校，也会等待学生，最后造成大面积的学校瘫痪。这里学生我们看成一个个请求。熔断器就是把某事故的蔓延即使熔断了。

当然这些组件也都是微服务，也需要注册到 Eureka 注册中心中。**Spring Cloud** 就可以看成是这个学校了。众多上面提到的组件相当于都是这个学校的各职能部门。

## SpringCloud 的版本关系

`SpringCloud` 是一个由许多子项目组成的综合项目，各子项目有不同的发布节奏，底层是依赖于 `SpringBoot` 的，并且有版本的兼容关系。 为了管理 `SpringCloud` 与各子项目的版本依赖关系，发布了一个清单，其中包括了某个 `SpringCloud` 版本对应的子项目版本。

为了避免 `SpringCloud` 版本号与子项目版本号混淆，`SpringCloud` 版本采用了名称而非版本号的命名，这些版本的名字采用了伦敦地铁站的名字，根据字母表的顺序来对应版本时间顺序，例如 Angel 是第一个版本, Brixton 是第二个版本。 当 `SpringCloud` 的发布内容积累到临界点或者一个重大 BUG 被解决后，会发布一个 "service releases" 版本，简称 SRX 版本，比如 Greenwich.SR2 就是 `SpringCloud` 发布的 Greenwich 版本的第 2 个 SRX 版本。

![](https://resource.lzyan.fun/PigGo/20211112104646.png)

## Spring Cloud 的总体架构图

![](https://resource.lzyan.fun/PigGo/克隆-springCloud微服务架构图.drawio.png)