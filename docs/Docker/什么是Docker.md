## 什么是docker

Docker 是一个开源项目，诞生于 2013 年初，最初是 dotCloud 公司内部的一个业余项目。它基于 Google 公司推出的 Go 语言实现。项目后来加入了 Linux 基金会，遵从了 Apache 2.0 协议，项目代码在[GitHub](https://github.com/docker/docker) 上进行维护。Docker 自开源后受到广泛的关注和讨论，以至于 dotCloud 公司后来都改名为 Docker Inc。Redhat 已经在其 RHEL6.5 中集中支持 Docker；Google 也在其 PaaS 产品中广泛应用。

来自于知乎的通俗解释： Docker的思想来自于集装箱，集装箱解决了什么问题？在一艘大船上，可以把货物规整的摆放起来。并且各种各样的货物被集装箱标准化了，集装箱和集装箱之间不会互相影响。那么我就不需要专门运送水果的船和专门运送化学品的船了。只要这些货物在集装箱里封装的好好的，那我就可以用一艘大船把他们都运走。（就拿现在流行的云计算来说，云计算就好比大货轮，docker就是集装箱。）

## 为什么使用docker

作为新兴虚拟化方式，Docker跟传统的虚拟化方式相比具有更多的优势点。

首先，Docker 容器的启动可以在秒级实现，这相比传统的虚拟机方式要快得多。其次，Docker 对系统资源的利用率很高，一台主机上可以同时运行数千个 Docker 容器。

容器除了运行其中应用外，基本不消耗额外的系统资源，使得应用的性能很高，同时系统的开销尽量小。传统虚拟机方式运行 10 个不同的应用就要起 10 个虚拟机，而Docker 只需要启动 10 个隔离的应用即可。

### 具体的特点：

- 轻量，在一台机器上运行的多个Docker容器可以共享这台机器的操作系统内核；它们能够迅速启动，只需占用很少的计算和内存资源。镜像是通过文件系统层进行构造的，并共享一些公共文件。这样就能尽量降低磁盘用量，并能更快地下载镜像。
- 标准，Docker容器基于开放式标准，能够在所有主流Linux版本、Microsoft Windows以及包括VM、裸机服务器和云在内的任何基础设施上运行。
- 安全，Docker赋予应用的隔离性不仅限于彼此隔离，还独立于底层的基础设施。Docker默认提供最强的隔离，因此应用出现问题，也只是单个容器的问题，而不会波及到整台机器。

### 应用的场景：

- 不同的应用程序可能会有不同的应用环境，比如.net开发的网站和php开发的网站以来的软件就不一样，如果把他们依赖的软件都安装在一个服务器上就要调试很久，并且会很麻烦，还会造成不必要的冲突。这个时候就要隔离.net开发的网站和php开发的网站。通常来讲，可以在服务器上创建不同的虚拟机在不同的虚拟机上放置不同的应用，但是虚拟机的开销会比较高。docker可以实现虚拟机隔离应用环境的功能，并且开销比虚拟机小，而小就意味着省钱了。
- 当你开发软件的时候是用的Ubuntu，但是运维管理的是centos，运维需要把你的软件从开发环境转到生产环境的时候就会遇到一些Ubuntu转centos的问题，比如：有个特殊版本的数据库，只有Ubuntu支持，centos不支持，在转移的过程当中运维就得想办法解决这样的问题。这时候要是有docker你就可以把开发环境直接封装转移给运维，运维直接部署你给他的docker就可以了。简单便捷快速。
- 在服务器负载方面，如果单独开一个虚拟机，那么虚拟机会占用空闲内存，docker部署的话，这些内存就会利用起来。

与Java的平台兼容性相仿：

Java号称“一次编译，到处运行”，因为Java虚拟机解决平台的兼容性问题，所以在有Java虚拟机的地方就可以跑Java代码了；

那么Docker就是“一次封装，到处运行”，因为docker解决了应用环境的问题，安装了docker的平台就能跑“docker 包”，如此就解决了“开发环境了跑，一上线就崩了”的尴尬场面。

## docker的C/S架构

![image-20200526153544075.png](http://resource.lzyan.fun/lzyan_blog_system/2021_04_16/png/832596758524592128.png)

## 核心概念

- 仓库（Repository）——集中存放镜像文件的地方

仓库是集中存放镜像文件的场所。有时候会把仓库和仓库注册服务器（Registry）混为一谈，并不严格区分。实际上，仓库注册服务器上往往存放着多个仓库，每个仓库中又包含了多个镜像，每个镜像有不同的标签（tag）。

仓库分为公开仓库（Public）和私有仓库（Private）两种形式。最大的公开仓库是 Docker Hub，存放了数量庞大的镜像供用户下载。国内的公开仓库包括 时速云 、网易云 等，可以提供大陆用户更稳定快速的访问。当然，用户也可以在本地网络内创建一个私有仓库。

当用户创建了自己的镜像之后就可以使用 push 命令将它上传到公有或者私有仓库，这样下次在另外一台机器上使用这个镜像时候，只需要从仓库上 pull 下来就可以了。

Docker 仓库的概念跟 Git 类似，注册服务器可以理解为 GitHub 这样的托管服务

- 镜像（Image）——一个特殊的文件系统

Docker 镜像就是一个只读的模板。例如：一个镜像可以包含一个完整的操作系统环境，里面仅安装了 Apache 或用户需要的其它应用程序。镜像可以用来创建 Docker 容器，一个镜像可以创建很多容器。Docker 提供了一个很简单的机制来创建镜像或者更新现有的镜像，用户甚至可以直接从其他人那里下载一个已经做好的镜像来直接使用。

镜像（Image）就是一堆只读层（read-only layer）的统一视角，也许这个定义有些难以理解，看看下面这张图：

![image-20200526162536514.png](http://resource.lzyan.fun/lzyan_blog_system/2021_04_16/png/832596899100884992.png)

右边我们看到了多个只读层，它们重叠在一起。除了最下面一层，其它层都会有一个指针指向下一层。这些层是Docker内部的实现细节，并且能够在docker宿主机的文件系统上访问到。统一文件系统（Union File System）技术能够将不同的层整合成一个文件系统，为这些层提供了一个统一的视角，这样就隐藏了多层的存在，在用户的角度看来，只存在一个文件系统。

- 容器（Container）——镜像运行时的实体

Docker 利用容器（Container）来运行应用。容器是从镜像创建的运行实例。它可以被启动、开始、停止、删除。每个容器都是相互隔离的、保证安全的平台。可以把容器看做是一个简易版的 Linux 环境（包括root用户权限、进程空间、用户空间和网络空间等）和运行在其中的应用程序。

容器的定义和镜像几乎一模一样，也是一堆层的统一视角，唯一区别在于容器的最上面那一层是可读可写的。 ![image-20200526162714854.png](http://resource.lzyan.fun/lzyan_blog_system/2021_04_16/png/832597043825344512.png)

一个运行态容器被定义为一个可读写的统一文件系统加上隔离的进程空间和包含其中的进程。